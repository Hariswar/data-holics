{% extends 'master_template.html' %}

{% block title %}
<title>Leaguify | User Home</title>
{% endblock %}

{% block header %}
<h1>User Home</h1>
{% endblock %}


{% block body %}
{% if teams %}
    <h3>Teams</h3>
    <table>
        <tr>
            <th>Team</th>
            <th>League</th>
            <th>Sport</th>
        </tr>
        {% for t in teams %}
        <tr>
            <td><a href="team/{{ t.team.id }}">{{ t.team.teamName }}</a></td>
            <td><a href="league/{{ t.league.id }}">{{ t.league.leagueName }}</a></td>
            <td>{{ t.league.sportID.sportName }}</td>
        </tr>
        {% endfor %}
    </table>
{% else %}
    <p class="text_center">Your teams will appear here. Join a team, create one in an active league, or create a league to get started!</p>
{% endif %}

<h3>Social Media</h3>
{% if social_media %}
<table>
    <tr>
        <th>Platform</th>
        <th>Username</th>
    </tr>
    {% for sm in social_media %} 
    <tr>
        <td>{{ sm.type }}</td>
        <td>{{ sm.userName }}</td>
    </tr>
    {% endfor %}
</table>
{% endif %}
<a href="{% url 'add_player_social_media' %}"><button>Add Social Media</button></a>

<hr>

<!-- Player Stats -->
<h2 class="text_center">Your Stats</h2>
<!-- Auto-loaded General Stats -->
{% if general_stats %}

    {% for stat in general_stats %}
    <p class="text_center">
        <strong>Sport:</strong> {{ stat.sportID.sportName }} |
        <strong>League:</strong> {{ stat.leagueID.leagueName }} |
        <strong>Team:</strong> {{ stat.teamID.teamName }} |
        <strong>Score:</strong> {{ stat.score }} |
        <strong>Wins:</strong> {{ stat.wins }} |
        <strong>Losses:</strong> {{ stat.losses }} |
        <strong>Draws:</strong> {{ stat.draws }} |
        <strong>Win %:</strong> {{ stat.winPercent|floatformat:2 }}% |
        <strong>Games Played:</strong> {{ stat.gamesPlayed }}
    </p>
    {% endfor %}

{% else %}
<p class="text_center">You have no stats to display at this time.</p>
{% endif %}

<!-- Highest scoring game -->
{% if highest_game %}
<hr>
<h3 class="text_center">Highest Scoring Game:</h3>
<p class="text_center">
    <strong>Team:</strong> {{ highest_game.teamID.teamName }} |
    <strong>League:</strong> {{ highest_game.leagueID.leagueName }} |
    <strong>Sport:</strong> {{ highest_game.sportID.sportName }} |
    <strong>Score:</strong> {{ highest_game.score }}
</p>
{% endif %}

<hr>

<!-- Filters Below -->
<h3 class="text_center">Filter Stats by League or Sport</h3>
<form method="post" class="text_center" action="">
    {% csrf_token %}

    <label for="filter_type">Filter By:</label>
    <select name="filter_type" required>
        <option value="">-- Select Filter Type --</option>
        <option value="sport">Specific Sport</option>
        <option value="league">Specific League</option>
    </select>
    <br>

    <label for="sport">Choose Sport:</label>
    <select name="sport">
        <option value="">-- Select Sport --</option>
        {% for sport in sports %}
        <option value="{{ sport.id }}">{{ sport.sportName }}</option>
        {% endfor %}
    </select>
    <br>

    <label for="league">Choose League:</label>
    <select name="league">
        <option value="">-- Select League --</option>
        {% for league in leagues %}
        <option value="{{ league.id }}">{{ league.leagueName }}</option>
        {% endfor %}
    </select>
    <br>

    <input type="submit" value="Submit">
</form>

<!-- Display filtered results -->
{% if error %}
<p style="color: red;">{{ error }}</p>
{% endif %}

{% if results %}
<hr>
<h3>Filtered Results:</h3>
<ul>
    {% for stat in results %}
    <li>
        <strong>Sport:</strong> {{ stat.sportID.sportName }} |
        <strong>League:</strong> {{ stat.leagueID.leagueName }} |
        <strong>Team:</strong> {{ stat.teamID.teamName }} |
        <strong>Score:</strong> {{ stat.score }} |
        <strong>Wins:</strong> {{ stat.wins }} |
        <strong>Losses:</strong> {{ stat.losses }} |
        <strong>Draws:</strong> {{ stat.draws }} |
        <strong>Win %:</strong> {{ stat.winPercent|floatformat:2 }}% |
        <strong>Games Played:</strong> {{ stat.gamesPlayed }}
    </li>
    {% endfor %}
</ul>
{% endif %}

{% endblock %}


